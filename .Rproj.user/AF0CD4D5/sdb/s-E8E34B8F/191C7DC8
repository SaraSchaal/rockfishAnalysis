{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Species Growth Analysis\"\nauthor: \"Sara Michele Schaal\"\ndate: \"5/13/2019\"\noutput: html_document\n---\n\n## Data Manipulation\n```{r}\n## Read in Data ##\n  copper.data <- read.csv(\"./data/Copper_Weight.csv\", header = TRUE)\n  black.data <- read.csv(\"./data/Black_Weight.csv\", header = TRUE)\n\n## Set Buckets to Correct Experimental Temperature \n  # CQ Complex\n  for (i in 1:nrow(copper.data)){\n    if(copper.data$Bucket[i] == 1){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 10.51111)\n    }else if(copper.data$Bucket[i] == 2){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 10.58704)\n   }else if(copper.data$Bucket[i] == 3){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 13.46111)\n    }else if(copper.data$Bucket[i] == 4){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 13.71667)\n    }else if(copper.data$Bucket[i] == 5){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 15.10000)\n    }else if(copper.data$Bucket[i] == 6){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 17.15000)\n    }else if(copper.data$Bucket[i] == 7){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 17.97037)\n    }else if(copper.data$Bucket[i] == 8){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.22222)\n    }else if(copper.data$Bucket[i] == 9){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 18.90926)\n    }else if(copper.data$Bucket[i] == 10){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.98889)\n    }else if(copper.data$Bucket[i] == 11){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.91852)\n    }else if(copper.data$Bucket[i] == 12){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 21.03333)\n    }else if(copper.data$Bucket[i] == 13){\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 21.40741)\n    }else {\n      copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 22.01296)\n    }\n  }\n  \n  # BY Complex\n  for (i in 1:nrow(black.data)){\n    if(black.data$Bucket[i] == 1){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 10.45769)\n    }else if(black.data$Bucket[i] == 2){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 10.33846)\n    }else if(black.data$Bucket[i] == 3){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 14.09038)\n    }else if(black.data$Bucket[i] == 4){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 13.89808)\n    }else if(black.data$Bucket[i] == 5){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 15.23462)\n    }else if(black.data$Bucket[i] == 6){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 17.86923)\n    }else if(black.data$Bucket[i] == 7){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.35962)\n    }else if(black.data$Bucket[i] == 8){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 18.48462)\n    }else if(black.data$Bucket[i] == 9){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.98462)\n    }else if(black.data$Bucket[i] == 10){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.45192)\n    }else if(black.data$Bucket[i] == 11){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.18269)\n    }else if(black.data$Bucket[i] == 12){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.71346)\n    }else if(black.data$Bucket[i] == 13){\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.97308)\n    }else {\n      black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 22.61731)\n    }\n  }\n\n  # Remove bad measurement in CQ complex\n  copper.data <- copper.data[-34,]\n\n  # Get full dataframe for analyzing across all species\n  grow.data <- rbind(copper.data, black.data)\n  \n  # Remove samples with unknown species\n  grow.data <- grow.data[grow.data$Species_Seq == \"Black\" |\n                        grow.data$Species_Seq == \"Yellowtail\" |\n                        grow.data$Species_Seq == \"Copper\" |\n                        grow.data$Species_Seq == \"Quillback\",]\n  \n  #### Combine Quillback and Copper ####\n  # Make a new species column that combines black and yellowtail rockfish\n  grow.data$Species2 <- NA\n    \n  # Find all rows where species is either black or yellowtail and add BY to new species column\n  for(i in 1:nrow(grow.data)){\n    if(grow.data$Species_Seq[i] == \"Copper\" | grow.data$Species_Seq[i] == \"Quillback\"){\n      grow.data$Species2[i] <- \"CQ\"\n    } else if(grow.data$Species_Seq[i] == \"Black\" | grow.data$Species_Seq[i] == \"Yellowtail\") {\n      grow.data$Species2[i] <- \"BY\"\n    }\n  }\n  \n  # Factor new species column\n  grow.data$Species2 <- as.factor(grow.data$Species2)\n  # Change factor level names\n  levels(grow.data$Species2) <- c(\"BY\", \"CQ\")  \n\n```\n \n \n## Calculate Growth Indices\n```{r}\n\n## Percent Weight Change\n grow.data$Per_Weight <- ((grow.data$End_Weight - grow.data$Start_Weight)/\n                                 (grow.data$Start_Weight))*100\n## Condition Factor\n grow.data$CF <- ((grow.data$End_Weight/(grow.data$End_Length)^3)*100)-\n      ((grow.data$Start_Weight/(grow.data$Start_Length)^3)*100)\n\n grow.data$CFend <- ((grow.data$End_Weight/(grow.data$End_Length)^3)*100)\n grow.data$CFstart <- ((grow.data$Start_Weight/(grow.data$Start_Length)^3)*100)\n```\n\n## Percent Weight Change Analysis\n```{r}\n#########################\n##### Complex Level #####\n#########################\n\n## Interaction between Temp and Species\n  grow.cl.m1 <- lm(grow.data$Per_Weight~grow.data$Bucket*grow.data$Species2)\n  summary(grow.cl.m1)\n  Anova(grow.m1, type = 2)\n  drop1(grow.m1)\n\n # Assumptions\n  par(mfrow = c(2,2))\n  plot(grow.cl.m1)\n  par(mfrow = c(1,1))\n  hist(grow.cl.m1$residuals)\n  shapiro.test(grow.cl.m1$residuals)\n  \n # Not met perform log transformation \n  grow.cl.m1 <- lm(log10(grow.data$Per_Weight+100)~grow.data$Bucket*grow.data$Species2)\n  summary(grow.cl.m1)\n  Anova(grow.cl.m1, type = 2)\n  drop1(grow.m1)\n  \n## Main Effects of Temp and Species\n  grow.cl.m2 <- lm(log10(grow.data$Per_Weight+100)~grow.data$Bucket+grow.data$Species2)\n  summary(grow.cl.m2)\n  Anova(grow.cl.m2, type = 2)\n  drop1(grow.cl.m2)\n  \n## Main Effects of Temp and Species\n  grow.cl.m3 <- lm(log10(grow.data$Per_Weight+100)~grow.data$Bucket)\n  summary(grow.cl.m3)\n  Anova(grow.cl.m3, type = 2)\n  drop1(grow.cl.m3)\n\n############################\n#### Individual Species ####\n############################\n## Interaction between Temp and Species\n  grow.m1 <- lm(grow.data$Per_Weight~grow.data$Bucket*grow.data$Species_Seq)\n  summary(grow.m1)\n  Anova(grow.m1, type = 2)\n  drop1(grow.m1)\n  \n## Main Effects of Temp and Species\n  grow.m2 <- lm(grow.data$Per_Weight~grow.data$Bucket + grow.data$Species_Seq)\n  summary(grow.m2)\n  Anova(grow.m2, type = 2)\n  drop1(grow.m2)\n  anova(grow.m1, grow.m2, test = \"LRT\")\n  # no species interaction drop interaction LRT not significant\n  \n## Main Effect of Temp\n  grow.m3 <- lm(grow.data$Per_Weight~grow.data$Bucket)\n  summary(grow.m3)\n  anova(grow.m2, grow.m3, test = \"LRT\")\n  # model 2 is not significant drop Species term\n  \n  # Assumptions\n  par(mfrow = c(2,2))\n  plot(grow.m1)\n  par(mfrow = c(1,1))\n  hist(grow.m1$residuals)\n  shapiro.test(grow.m3$residuals)\n  \n## Log10 - corrects for non-normality\n  grow.m3Log <- lm(log10(grow.data$Per_Weight+100)~grow.data$Bucket)\n  summary(grow.m3Log)\n  Anova(grow.m3Log, type = 2)\n  \n  # Assumptions  \n  par(mfrow = c(2,2))\n  plot(grow.m3Log)\n  par(mfrow = c(1,1))\n  hist(grow.m3Log$residuals)  \n  shapiro.test(grow.m3Log$residuals)\n\n\n```\n\n\n```{r}\n##################\n#### Plotting ####\n##################\n  \n  plot(grow.data$Per_Weight~grow.data$Bucket, pch = 19,\n       bty = \"l\", ylab = \"Percent Weight Change\", xlab = \"Temperature\", \n       main = \"All Species Growth Across Temperatures\")\n  text(20, 33, \"-2.08 +/- 0.36***\")\n  abline(grow.m1, lwd = 3)\n\n# Plot with 3 non significant species black and quillback in brown with separate line\npar(mfrow = c(1,2))\n plot(grow.data$Per_Weight[grow.data$Species_Seq == \"Black\"]~\n         grow.data$Bucket[grow.data$Species_Seq == \"Black\"], \n       pch = 19, col = \"black\", bty = \"l\", \n       ylab = expression(paste(Delta, \" Percent Weight\")),\n       xlab = expression(paste('Treatment Temperature (',degree,'C)',sep='')), ylim = c(-44, 55))\n points(grow.data$Per_Weight[grow.data$Species_Seq == \"Yellowtail\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Yellowtail\"], \n        col = \"black\", pch = 15)\n points(grow.data$Per_Weight[grow.data$Species_Seq == \"Copper\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Copper\"], \n        col = \"black\", pch = 18)\n points(grow.data$Per_Weight[grow.data$Species_Seq == \"Quillback\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Quillback\"], \n        col = \"black\", pch = 17)\n #legend(\"topright\", legend = c(\"Black\", \"Yellowtail\", \"Copper\", \"Quillback\", \n                        #  \"model fit\"), \n        #pch = c(19,15,18,17,NA), lty = c(NA, NA, NA, NA, 1), lwd = 2)\n summary(grow.m3Log)\n \npredicted <- predict(grow.m3Log, Bucket = 10:23)    \nlines(10:23, 10^(predicted), col = \"blue\")\nabline(10^(grow.m3Log$coefficients[1]), 10^(grow.m3Log$coefficients[2]))\n\n##############################\n#### Condition Index Plot ####\n##############################\n  plot(grow.data$CF[grow.data$Species_Seq == \"Black\"]~\n         grow.data$Bucket[grow.data$Species_Seq == \"Black\"], \n       pch = 19, bty = \"l\", ylab = expression(paste(Delta, \" Condition Index\")), \n       xlab = expression(paste('Treatment Temperature (',degree,'C)',sep='')), \n       ylim = c(-0.0005, 0.0005))\n  points(grow.data$CF[grow.data$Species_Seq == \"Yellowtail\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Yellowtail\"], \n        col = \"black\", pch = 15)\n  points(grow.data$CF[grow.data$Species_Seq == \"Copper\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Copper\"], \n        col = \"black\", pch = 18)\n  points(grow.data$CF[grow.data$Species_Seq == \"Quillback\"]~\n        grow.data$Bucket[grow.data$Species_Seq == \"Quillback\"], \n        col = \"black\", pch = 17)\n  legend(\"topright\", legend = c(\"Black\", \"Yellowtail\", \"Copper\", \"Quillback\", \n                          \"model fit\"), \n        pch = c(19,15,18,17,NA), lty = c(NA, NA, NA, NA, 1), lwd = 2)\n  abline(grow.CF.m3, lwd = 2)\n  \n\n```\n\n## Condition Index Analysis\n```{r}\n## Interaction between Temp and Species\n  grow.CF.m1 <- lm(grow.data$CF~grow.data$Bucket*grow.data$Species_Seq)\n  summary(grow.CF.m1)\n  Anova(grow.CF.m1, type = 2)\n  drop1(grow.m1)\n  \n  grow.CF.m2 <- lm(grow.data$CF~grow.data$Bucket+grow.data$Species_Seq)\n  summary(grow.CF.m2)\n  Anova(grow.CF.m2, type = 2)\n  drop1(grow.m2)\n  \n  grow.CF.m3 <- lm(grow.data$CF~grow.data$Bucket)\n  summary(grow.CF.m3)\n  Anova(grow.CF.m3, type = 2)\n  drop1(grow.m3)\n  \n  hist(grow.CF.m3$residuals)\n  shapiro.test(grow.CF.m3$residuals)\n  par(mfrow = c(2,2))\n  plot(grow.CF.m3)\n  \n  \n```",
    "created" : 1557760320274.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "157246251",
    "id" : "191C7DC8",
    "lastKnownWriteTime" : 1558012718,
    "last_content_update" : 1559074945695,
    "path" : "~/Documents/Northeastern/LotterhosLab/Research/Field_Work/2015/TPC_Experiment/Analysis/scripts/Species_Growth_Analysis.Rmd",
    "project_path" : "scripts/Species_Growth_Analysis.Rmd",
    "properties" : {
        "chunk_output_type" : "console",
        "tempName" : "Untitled1"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}