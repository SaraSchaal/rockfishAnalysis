{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Mortality Data Analysis\"\nauthor: \"Sara Michele Schaal\"\ndate: \"5/9/2019\"\noutput: html_document\n---\n\n## Load Relevant Packages\n```{r}\n    if(!(\"AICcmodavg\" %in% installed.packages())){\n      install.packages(\"AICcmodavg\")\n    }\n    if(!(\"car\" %in% installed.packages())){\n      install.packages(\"car\")\n    }\n    if(!(\"multcomp\" %in% installed.packages())){\n      install.packages(\"multcomp\")\n    }\n    if(!(\"lsmeans\" %in% installed.packages())){\n      install.packages(\"lsmeans\")\n    }\n    if(!(\"multcompView\" %in% installed.packages())){\n      install.packages(\"multcompView\")\n    }\n\n  library(AICcmodavg)\n  library(car)\n  library(multcomp)\n  library(lsmeans)\n  library(multcompView)\n```\n\n## Data Manipulation\n```{r}\n## Read In Data ##\n  mort.data <- read.csv(\"./data/Mortality.csv\")\n  # round temperature data\n  mort.data$Treatment_Temperature <- round(mort.data$Treatment_Temperature, digits = 1)\n  # remove those that could not be identified to the species level \n  mort.data <- mort.data[!mort.data$Species == \"\" & !mort.data$Species == \"Hybrid\",]\n  # calculate days dead and survived\n  mort.data$DaysDead <- 14-mort.data$Days_Survived\n  mort.data$PropDaysSurv <- mort.data$Days_Survived/14\n  \n\n## Combine Black and Yellowtail Data ##\n  # Make a new species column that combines black and yellowtail rockfish\n  mort.data$Species2 <- NA\n    \n  # Find all rows where species is either black or yellowtail and add BY to new species column\n  for(i in 1:nrow(mort.data)){\n    if(mort.data$Species[i] == \"Black\" | mort.data$Species[i] == \"Yellowtail\"){\n      mort.data$Species2[i] <- \"BY\"\n    } else {\n      mort.data$Species2[i] <- mort.data$Species[i]\n    }\n  }\n  # Factor new species column\n  mort.data$Species2 <- as.factor(mort.data$Species2)\n  # Set levels to meaningful names\n  levels(mort.data$Species2) <- c(\"Copper\", \"Quillback\", \"BY\")\n  \n  \n#### Combine Quillback and Copper ####\n  # Make a new species column that combines black and yellowtail rockfish\n  mort.data$Species3 <- NA\n    \n  # Find all rows where species is either black or yellowtail and add BY to new species column\n  for(i in 1:nrow(mort.data)){\n    if(mort.data$Species2[i] == \"Copper\" | mort.data$Species2[i] == \"Quillback\"){\n      mort.data$Species3[i] <- \"CQ\"\n    } else {\n      mort.data$Species3[i] <- mort.data$Species2[i]\n    }\n  }\n  # Factor new species column\n  mort.data$Species3 <- as.factor(mort.data$Species3)\n  # Change factor level names\n  levels(mort.data$Species3) <- c(\"BY\", \"CQ\") \n```\n\n# Analyses\n### Binomial - Temperature by Species\n```{r}\n################################\n#### Complex Level Analysis ####\n################################\n ## Logistic regression with interaction of temp and species where complexes are combined \n  log.mod.all.complex <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature*Species3,\n                           family = binomial(link = 'logit'), data = mort.data)\n  summary(log.mod.all.complex)\n  Anova(log.mod.all.complex, type = 2)\n  ## Use capital Anova for sums of squares that equals Type II sums of squares where \n  ## the SS are calculated for the main effects but not the interaction and should \n  ## only be used when there is not a significant interaction statistically more \n  ## powerful then Type III\n  \n ## Check Assumptions ##\n  # Dispersion\n  var(mort.data$DaysDead) # 9.71\n  mean(mort.data$DaysDead) # 1.72\n  # Data are overdispersed\n  \n  # Diagnostic plots for outliers and intercorrelation\n  par(mfrow = c(2,2))\n  plot(log.mod.all.complex)\n  # variance is not equal across data points (scale-location plot) change to quasibinomial\n  \n  # Autocorrelation\n  par(mfrow = c(1,1))\n  acf(log.mod.all.complex$residuals)\n  # no autocorrelation  \n  \n## Switch to quasibinomial to relax data assumptions\n  ## (this will produce conservative p-values if you have overdispersion)\n  \n ## Logistic regression with interaction of temp and species where complexes are combined \n  quasi.mod.all.complex <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature*Species3,\n                           family = quasibinomial(link = 'logit'), data = mort.data)\n  summary(quasi.mod.all.complex)\n  Anova(quasi.mod.all.complex, type = 2)\n  \n  # Significant interaction but check likelihood ratio test to ensure best model\n  quasi.mod.all.complex2 <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature+Species3,\n                           family = quasibinomial(link = 'logit'), data = mort.data)\n  anova(quasi.mod.all.complex, quasi.mod.all.complex2, test = \"LRT\")\n  ## Model 1 with interaction is the best model\n  \n###################################\n#### Species in a Single Model ####\n###################################\n### All Four Species ##############\n## Logistic regression for the interaction between temperature and species on survival\n  log.mod.all.prop <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature*Species, \n                            family = quasibinomial(link = 'logit'), data = mort.data)\n  summary(log.mod.all.prop)\n  summary(aov(log.mod.all.prop))\n  drop1(log.mod.all.prop)\n  # Best Model\n  # Giving warning because of the Yellowtail data. \n  # Its because the \"link\" score is very large. \n  # We have overfit our data.\n\n#####################\n#### BY Combined ####\n#####################\n ## Logistic regression with interaction of temp and species where BY combined \n  quasiModel1 <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature*Species2, \n              family = quasibinomial(link = \"logit\"),\n              data = mort.data)\n  summary(quasiModel1)\n  Anova(quasiModel1, type = 2) \n  # Interaction is not significant check LRT\n\n  # dropping interaction term\n  quasiModel2 <- glm(cbind(Days_Survived, DaysDead)~Treatment_Temperature + Species2, \n              family = quasibinomial(link = \"logit\"),\n              data = mort.data)\n  anova(quasiModel1, quasiModel2,  test = \"LRT\")\n  # Can drop the interaction term due to nonsignificant LRT\n  Anova(quasiModel2, type = 2)\n  summary(quasiModel2)\n  \n  # run least-squares means to identify which species are different\n  multcompar <- lsmeans(quasiModel2, pairwise ~ Species2, adjust = \"Tukey\")\n  summary(multcompar)\n```\n\n# Plotting\n### Proportion days survived across temperature - Complex level\n### (4 panel plot)\n```{r}\n###################################################\n#### Create Prediction for Logistic Regression ####\n###################################################\n\n  BY.pred <- predict(quasi.mod.all.complex, data.frame(Treatment_Temperature = 10:23, \n                                                     Species3 = \"BY\"), se.fit = TRUE)\n  CQ.pred <- predict(quasi.mod.all.complex, data.frame(Treatment_Temperature = 10:23, \n                                                     Species3 = \"CQ\"), se.fit = TRUE)\n  Quill.pred <- predict(quasiModel2, data.frame(Treatment_Temperature = 10:23, \n                                                Species2 = \"Quillback\"), se.fit = TRUE)\n  Copper.pred <- predict(quasiModel2, data.frame(Treatment_Temperature = 10:23, \n                                                     Species2 = \"Copper\"), se.fit = TRUE)\n\n##############\n#### Plot ####\n##############\n  \n# set the plotting window - 4 panels  \n  par(mfrow = c(2,2))\n  par(oma = c(4, 4, 1, 1))\n  par(mar = c(2, 2, 1, 1))\n  \n############################\n#### BY Complex Panel A ####\n############################\n  \n  plot(mort.data$PropDaysSurv[mort.data$Species == \"Black\"] ~\n       mort.data$Treatment_Temperature[mort.data$Species == \"Black\"], \n       xlim = c(10,23), col = \"black\", pch = 19, bty = \"l\", \n       ylim = c(0,1), xaxt = \"n\")\n  points(mort.data$PropDaysSurv[mort.data$Species == \"Yellowtail\"] ~ \n         mort.data$Treatment_Temperature[mort.data$Species == \"Yellowtail\"], \n          pch = 19, col = \"black\")\n  points(y=exp(BY.pred$fit)/(1+exp(BY.pred$fit)), x = 10:23,\n         type = \"l\")\n  points(y = exp(BY.pred$fit+1.96*BY.pred$se.fit)/\n           (1+exp(BY.pred$fit+1.96*BY.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  points(y = exp(BY.pred$fit-1.96*BY.pred$se.fit)/\n             (1+exp(BY.pred$fit-1.96*BY.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  legend(\"bottomleft\", legend = \"BY Complex\", pch = 19, \n         col = \"black\",  cex = 0.8)\n  mtext(text = \"A\", side = 3, adj = 0.01, padj = 0.01)\n  \n########################  \n#### Copper Panel C ####\n########################\n  \n  plot(PropDaysSurv[mort.data$Species==\"Copper\"]~\n         Treatment_Temperature[mort.data$Species==\"Copper\"], \n       data = mort.data, pch = 15, col = \"darkorange2\", yaxt = \"n\",\n       bty = \"l\", ylim = c(0,1), xlim = c(10,23), xaxt = \"n\")\n  points(y=exp(Copper.pred$fit)/(1+exp(Copper.pred$fit)), x = 10:23,\n         type = \"l\")\n  points(y = exp(Copper.pred$fit-1.96*(Copper.pred$se.fit))/\n              (1+exp(Copper.pred$fit-1.96*Copper.pred$se.fit)), \n         x = 10:23, type = \"l\", col = \"lightgrey\")\n  points(y = exp(Copper.pred$fit+1.96*(Copper.pred$se.fit))/\n              (1+exp(Copper.pred$fit+1.96*Copper.pred$se.fit)), \n         x = 10:23, type = \"l\", col = \"lightgrey\")\n  legend(\"bottomleft\", legend = \"Copper\", pch = 15, col = \"darkorange2\", cex = 0.8)\n  mtext(text = \"C\", side = 3, adj = 0.01, padj = 0.01)\n\n############################\n#### CQ complex Panel B ####\n############################\n  \n  plot(mort.data$PropDaysSurv[mort.data$Species == \"Copper\"] ~\n       mort.data$Treatment_Temperature[mort.data$Species == \"Copper\"], \n       col = \"orange\", xlim = c(10,23), xlab = \"\",\n       pch = 19, bty = \"l\", ylim = c(0,1), ylab = \"\")\n  points(mort.data$PropDaysSurv[mort.data$Species == \"Quillback\"] ~ \n         mort.data$Treatment_Temperature[mort.data$Species == \"Quillback\"], \n         col = \"orange\", pch = 19)\n  points(y=exp(CQ.pred$fit)/(1+exp(CQ.pred$fit)), x = 10:23,\n         type = \"l\")\n  points(y = exp(CQ.pred$fit+1.96*CQ.pred$se.fit)/\n           (1+exp(CQ.pred$fit+1.96*CQ.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  points(y = exp(CQ.pred$fit-1.96*CQ.pred$se.fit)/\n             (1+exp(CQ.pred$fit-1.96*CQ.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  legend(\"bottomleft\", legend = \"CQ Complex\", pch = 19, \n         col = \"orange\", cex = 0.8)\n  mtext(text = \"B\", side = 3, adj = 0.01, padj = 0.01)\n\n###########################\n#### Quillback Panel D ####\n###########################\n  \n  plot(PropDaysSurv[mort.data$Species==\"Quillback\"]~\n         Treatment_Temperature[mort.data$Species==\"Quillback\"], \n       data = mort.data, pch = 17, col = \"brown\", yaxt = \"n\",\n       bty = \"l\", ylim = c(0,1), xlim = c(10,23), xlab = \"\", ylab = \"\")\n  points(y=exp(Quill.pred$fit)/(1+exp(Quill.pred$fit)), x = 10:23, type = \"l\")\n  points(y = exp(Quill.pred$fit+1.96*Quill.pred$se.fit)/\n           (1+exp(Quill.pred$fit+1.96*Quill.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  points(y = exp(Quill.pred$fit-1.96*Quill.pred$se.fit)/\n             (1+exp(Quill.pred$fit-1.96*Quill.pred$se.fit)), \n           x = 10:23, type = \"l\", col = \"lightgrey\")\n  legend(\"bottomleft\", legend = \"Quillback\", pch = 17, col = \"brown\", cex = 0.8)\n  mtext(text = \"D\", side = 3, adj = 0.01, padj = 0.01)\n  mtext(\"Proportion of Days Survived\", side = 2, outer = TRUE, cex = 1, line = 2.2)\n  mtext(expression(paste('Treatment Temperature (',degree,'C)',sep='')), side = 1, \n        outer = TRUE, cex = 1, line = 2.2)\n```",
    "created" : 1557411296651.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "653731017",
    "id" : "10567DC6",
    "lastKnownWriteTime" : 1558025659,
    "last_content_update" : 1558025659976,
    "path" : "~/Documents/Northeastern/LotterhosLab/Research/Field_Work/2015/TPC_Experiment/Analysis/scripts/Mortality_Data_Analysis.Rmd",
    "project_path" : "scripts/Mortality_Data_Analysis.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}