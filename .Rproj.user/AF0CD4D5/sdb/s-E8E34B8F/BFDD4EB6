{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Species Growth Analysis\"\nauthor: \"Sara Michele Schaal\"\ndate: \"November 8, 2016\"\noutput:\n  html_document: default\n  pdf_document: default\n---\n\n## Data Manipulation\n```{r}\n## Read in Data ##\n  df.growth <- read.csv(\"./data/Fish_Measurement_Data_Final.csv\") \n  # subset out CQ complex data\n  copper.df <- df.growth[df.growth$Species_Seq == \"Copper\" | df.growth$Species_Seq == \"Quillback\",]\n\n  # check to make sure there wasn't a drastic change in parasites over the experiment\n  boxplot(copper.df$Number_of_Parasites ~ copper.df$Date)\n\n  # Subset Dataframe to Include only Those Necessary for Analysis\n  df.subgrowth  <- subset(df.growth, select = c(\"Date\", \"Species_Seq\", \"Length_mm\", \"Weight_g\",\n                                                  \"Individual_IDs\", \"Experimental_Treatment_C\",\n                                                  \"Bucket\"))\n  # Remove columns with any NAs\n  df.completegrowth <- na.omit(df.subgrowth)\n\n  # Correct start and end days for two experiments\n  start.day.blk <- subset(df.completegrowth, df.completegrowth$Date==20150620)\n  last.day.blk <- subset(df.completegrowth, df.completegrowth$Date==20150703)\n  start.day.cp <- subset(df.completegrowth, df.completegrowth$Date==20150704)\n  last.day.cp <- subset(df.completegrowth, df.completegrowth$Date==20150718)\n    \n  write.csv(last.day.blk, \"last_day_black.csv\")\n  write.csv(last.day.cp, \"last_day_copper.csv\")\n  write.csv(start.day.blk, \"start.day.blk.csv\")\n  write.csv(start.day.cp, \"start.day.cp.csv\")\n    \n  copper.data <- read.csv(\"./data/Copper_Weight.csv\", header = TRUE)\n  black.data <- read.csv(\"./data/Black_Weight.csv\", header = TRUE)\n    \n```\n\n## Set Buckets to Correct Experimental Temperature \n```{r}\n\n# Copper\nfor (i in 1:nrow(copper.data)){\n  if(copper.data$Bucket[i] == 1){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 10.51111)\n  }else if(copper.data$Bucket[i] == 2){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 10.58704)\n  }else if(copper.data$Bucket[i] == 3){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 13.46111)\n  }else if(copper.data$Bucket[i] == 4){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 13.71667)\n  }else if(copper.data$Bucket[i] == 5){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 15.10000)\n  }else if(copper.data$Bucket[i] == 6){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 17.15000)\n  }else if(copper.data$Bucket[i] == 7){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 17.97037)\n  }else if(copper.data$Bucket[i] == 8){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.22222)\n  }else if(copper.data$Bucket[i] == 9){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 18.90926)\n  }else if(copper.data$Bucket[i] == 10){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.98889)\n  }else if(copper.data$Bucket[i] == 11){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 19.91852)\n  }else if(copper.data$Bucket[i] == 12){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 21.03333)\n  }else if(copper.data$Bucket[i] == 13){\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 21.40741)\n  }else {\n    copper.data$Bucket[i] <- replace(copper.data$Bucket[i], 1, 22.01296)\n  }\n}\n\n#Black\nfor (i in 1:nrow(black.data)){\n  if(black.data$Bucket[i] == 1){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 10.45769)\n  }else if(black.data$Bucket[i] == 2){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 10.33846)\n  }else if(black.data$Bucket[i] == 3){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 14.09038)\n  }else if(black.data$Bucket[i] == 4){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 13.89808)\n  }else if(black.data$Bucket[i] == 5){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 15.23462)\n  }else if(black.data$Bucket[i] == 6){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 17.86923)\n  }else if(black.data$Bucket[i] == 7){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.35962)\n  }else if(black.data$Bucket[i] == 8){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 18.48462)\n  }else if(black.data$Bucket[i] == 9){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.98462)\n  }else if(black.data$Bucket[i] == 10){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 19.45192)\n  }else if(black.data$Bucket[i] == 11){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.18269)\n  }else if(black.data$Bucket[i] == 12){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.71346)\n  }else if(black.data$Bucket[i] == 13){\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 20.97308)\n  }else {\n    black.data$Bucket[i] <- replace(black.data$Bucket[i], 1, 22.61731)\n  }\n}\n\n# Remove bad data point in copper\ncopper.data <- copper.data[-34,]\n\n# Get full dataframe for analyzing across all species\nall.data <- rbind(copper.data, black.data)\n```\n \n## Calculate Growth Indices\n```{r}\n    # Calculate % Weight Change\n    #copper.data$Per_Weight <- ((copper.data$End_Weight - copper.data$Start_Weight)/\n                                 #(copper.data$Start_Weight))*100\n    #black.data$Per_Weight <- ((black.data$End_Weight - black.data$Start_Weight)/\n                                #(black.data$Start_Weight))*100\n    all.data$Per_Weight <- ((all.data$End_Weight - all.data$Start_Weight)/\n                                 (all.data$Start_Weight))*100\n    \n    # Get Condition Factor\n   # copper.data$CF <- ((copper.data$End_Weight/(copper.data$End_Length)^3)*100)-\n   #  ((copper.data$Start_Weight/(copper.data$Start_Length)^3)*100)\n   # black.data$CF <- ((black.data$End_Weight/(black.data$End_Length)^3)*100)-\n   #  ((black.data$Start_Weight/(black.data$Start_Length)^3)*100)\n    all.data$CF <- ((all.data$End_Weight/(all.data$End_Length)^3)*100)-\n      ((all.data$Start_Weight/(all.data$Start_Length)^3)*100)\n    \n```\n\n# Analyses\n## All Species Together\n```{r}\n#########################\n#### Model Selection ####\n#########################\n\n## Full Model \n  all.data <- all.data[all.data$Species_Seq == \"Black\" |\n                       all.data$Species_Seq == \"Yellowtail\" |\n                       all.data$Species_Seq == \"Copper\" |\n                       all.data$Species_Seq == \"Quillback\",]\n  \n  all.m1 <- lm(all.data$Per_Weight~all.data$Bucket*all.data$Species_Seq)\n  summary(aov(all.m1))\n  summary(all.m1)\n  Anova(all.m1, type = 2)\n  anova(all.m1, all.m2, test = \"LRT\")\n  drop1(all.m1)\n  # no species interaction but AIC and LRT shows it is the best model\n\n  all.m3 <- lm(all.data$Per_Weight~all.data$Bucket)\n  summary(all.m3)\n  # Assumptions\n  par(mfrow = c(2,2))\n  plot(all.m1)\n  par(mfrow = c(1,1))\n  hist(all.m1$residuals)\n  shapiro.test(all.m1$residuals)\n  \n## Log10 \n  all.m1Log <- lm(log10(all.data$Per_Weight)~all.data$Bucket*all.data$Species_Seq)\n  summary(aov(all.m1Log))\n  summary(all.m1Log)\n  Anova(all.m1Log, type = 2)\n  anova(all.m1Log, all.m2Log, test = \"LRT\")\n  drop1(all.m1Log)\n  \n  # Assumptions  \n  par(mfrow = c(2,2))\n  plot(all.m1Log)\n  par(mfrow = c(1,1))\n  hist(all.m1Log$residuals)  \n  shapiro.test(all.m1Log$residuals)\n  \n## Dropped interaction BUT NOT BEST MODEL JUST FOR CURIOSITY  \n  all.m2 <- lm(all.data$Per_Weight~all.data$Bucket + all.data$Species_Seq)\n  summary(all.m2)\n  summary(aov(all.m2))\n  Anova(all.m2, type = 2)\n  drop1(all.m2) # Shows a significant affect of temp on growth in Quillback but N = 6 \n  anova(all.m2Log, all.m1Log, test = \"LRT\")\n  \n## Log10 second model\n  all.m2Log <- lm(log10(all.data$Per_Weight+100)~all.data$Bucket + all.data$Species_Seq)\n  summary(all.m2Log)\n  summary(aov(all.m2Log))\n  Anova(all.m2Log, type = 2)\n  drop1(all.m2Log) # Shows a significant affect of temp on growth in Quillback but N = 6 \n  \n  #mc <- lsmeans(all.m1, pairwise ~ Species_Seq, adjust = \"Tukey\")\n  #summary(mc)\n  \n  lrtest(all.m2Log, all.m1Log)\n  \n  all.m3Log <- lm(log10(all.data$Per_Weight+100)~all.data$Bucket)\n  summary(all.m3Log)\n  \n  lrtest(all.m3Log, all.m2Log)\n##################\n#### Plotting ####\n##################\n  \n  plot(log10(all.data$Per_Weight[all.data$Species_Seq == \"Black\"]+100)~\n         all.data$Bucket[all.data$Species_Seq == \"Black\"], \n       pch = 19, col = \"black\", bty = \"l\", \n       ylab = \"Percent Weight Change\", \n       xlab = \"Temperature\", ylim = c(1, 3))\n  points(log10(all.data$Per_Weight[all.data$Species_Seq == \"Yellowtail\"]+100)~\n           all.data$Bucket[all.data$Species_Seq == \"Yellowtail\"], \n         col = \"black\", pch = 21, bg = \"goldenrod\")\n  points(log10(all.data$Per_Weight[all.data$Species_Seq == \"Copper\"]+100)~\n           all.data$Bucket[all.data$Species_Seq == \"Copper\"], \n         col = \"orange\", pch = 19)\n  points(log10(all.data$Per_Weight[all.data$Species_Seq == \"Quillback\"]+100)~\n           all.data$Bucket[all.data$Species_Seq == \"Quillback\"], \n         col = \"brown\", pch = 19)\n  legend(19.5,53, legend = c(\"Black\", \"Yellowtail\", \"Copper\", \"Quillback\"), \n         pch = c(19,21,19,19), pt.bg = c(\"black\", \"goldenrod\", \"orange\", \"brown\"), \n         col = c(\"black\", \"black\", \"orange\", \"brown\"))\n  abline(all.m4, col = \"darkgrey\", lwd = 3)\n  abline(quill.m1, col = \"brown\", lwd = 3)\n  \n\n  plot(all.data$Per_Weight~all.data$Bucket, pch = 19,\n       bty = \"l\", ylab = \"Percent Weight Change\", xlab = \"Temperature\", \n       main = \"All Species Growth Across Temperatures\")\n  text(20, 33, \"-2.08 +/- 0.36***\")\n  abline(all.m1, lwd = 3)\n\n# Plot with 3 non significant species black and quillback in brown with separate line\n\n plot(all.data$Per_Weight[all.data$Species_Seq == \"Black\"]~\n         all.data$Bucket[all.data$Species_Seq == \"Black\"], \n       pch = 19, col = \"black\", bty = \"l\", \n       ylab = \"log Percent Weight Change \", \n       xlab = \"Temperature\", ylim = c(-44, 55))\n points(all.data$Per_Weight[all.data$Species_Seq == \"Yellowtail\"]~\n        all.data$Bucket[all.data$Species_Seq == \"Yellowtail\"], \n        col = \"black\", pch = 15)\n points(all.data$Per_Weight[all.data$Species_Seq == \"Copper\"]~\n        all.data$Bucket[all.data$Species_Seq == \"Copper\"], \n        col = \"black\", pch = 18)\n points(all.data$Per_Weight[all.data$Species_Seq == \"Quillback\"]~\n        all.data$Bucket[all.data$Species_Seq == \"Quillback\"], \n        col = \"black\", pch = 17)\n legend(\"topright\", legend = c(\"Black\", \"Yellowtail\", \"Copper\", \"Quillback\", \n                          \"model fit\"), \n        pch = c(19,15,18,17,NA), lty = c(NA, NA, NA, NA, 1), lwd = 2)\n abline(all.m3Log, lwd = 2)\n summary(all.m3Log)\n \npredicted <- predict(all.m3Log, Bucket = 10:23)    \nlines(10:23, exp(predicted), col = \"blue\")\n \n #quillback.int <- summary(all.m2)$coefficient[1]+summary(all.m2)$coefficient[3]\n #abline(quillback.int, summary(all.m2)$coefficient[2], lty = 2, col = \"brown\", lwd = 2)\n #text(14, 50, label = \"BYC model fit -2.23x + 25.40\")\n #text(14, 43, label = \"Quillback model fit -2.23x + 16.34\")\n  \n```\n \n# Split Two Experiments (NOT USING ANYTHING THAT FOLLOWS)\n## Black Rockfish\n### Plotting\n```{r}\n\n# Separate Data into Species\n  black.data.2 <- subset(black.data, black.data$Species_Seq == \"Black\")\n  yellowtail.data <- subset(black.data, black.data$Species_Seq == \"Yellowtail\")\n\n# Plot Percent Weight Change\n  plot(black.data.2$Per_Weight~black.data.2$Bucket, col = \"black\",\n       lwd = 5, pch = 20, bty = \"l\", ylab = \"Percent Weight Change\", \n     xlab = expression(paste(\"Temperature (\",degree,\"C)\")), \n     main = \"Black Rockfish Experiment\", \n     ylim = c(-40, 60))\n  \n  points(yellowtail.data$Per_Weight~yellowtail.data$Bucket, \n         col = \"goldenrod\", lwd = 5, pch = 20)\n  legend(\"topright\", legend = c(\"Black\", \"Yellowtail\"), \n         pch = c(20, 20), col = c(\"black\", \"goldenrod\"))\n\n```\n\n## Model Selection\n```{r}\nBYdata <- all.data[all.data$Species_Seq == \"Black\" | all.data$Species_Seq == \"Yellowtail\",]\nmod1_blkAyt <- lm(BYdata$Per_Weight~BYdata$Bucket*BYdata$Species_Seq)\nsummary(mod1_blkAyt)\n# Drop Interaction Term not significant\n\nmod2_blkAyt <- lm(BYdata$Per_Weight~BYdata$Bucket + BYdata$Species_Seq + BYdata$Start_Weight)\nsummary(mod2_blkAyt)\ndrop1(mod2_blkAyt) # Drop Weight\n\nmod3_blkAyt <- lm(BYdata$Per_Weight~BYdata$Bucket + BYdata$Species_Seq)\nsummary(mod3_blkAyt)\ndrop1(mod3_blkAyt) # Drop Weight\n\nmod4_blkAyt <- lm(BYdata$Per_Weight~BYdata$Bucket)\nsummary(mod4_blkAyt) # Analyze together\n\n# Create Final Plot\n  plot(all.data$Per_Weight[all.data$Species_Seq == \"Black\"]~all.data$Bucket[all.data$Species_Seq == \"Black\"], col = \"black\",\n       lwd = 5, pch = 18, bty = \"l\", ylab = \"Percent Weight Change\", \n       xlab = \"Temperature\", ylim = c(-40, 60), \n       main = \"Black Rockfish Experiment\", cex.lab = 1.5)\n  points(all.data$Per_Weight[all.data$Species_Seq == \"Yellowtail\"]~\n         all.data$Bucket[all.data$Species_Seq == \"Yellowtail\"], col = \"goldenrod\", \n         lwd = 5, pch = 15, bty = \"l\")\n  abline(mod4_blkAyt, lwd = 3)\n  text(19,19, \"-1.45 +/- 0.24***\")\n  legend(\"topright\", legend = c(\"Black\", \"Yellowtail\"), \n         pch = c(18, 15), col = c(\"black\", \"goldenrod\"))\n  \n\n```\n\n## Copper Rockfish\n### Model Two Species Together (Copper & Quillback)\n```{r}\nmod1_cpAqb <- lm(copper.data$Per_Weight~copper.data$Bucket*copper.data$Species_Seq + copper.data$Species_Seq + copper.data$Start_Weight)\nsummary(mod1_cpAqb)\ndrop1(mod1_cpAqb)\n#Analyze separate? -- ** Struggling with this one no significant interaction term but the drop indicates I should leave species interaction in\n\n# \nmod2_cpAqb <- lm(copper.data$Per_Weight~copper.data$Bucket + copper.data$Species_Seq + copper.data$Start_Weight)\nsummary(mod2_cpAqb)\ndrop1(mod2_cpAqb) \n\nmod3_cpAqb <- lm(copper.data$Per_Weight~copper.data$Bucket + copper.data$Species_Seq)\nsummary(mod3_cpAqb)\n\ncop.quill.color <- c(\"orange\", \"brown\")\npalette(cop.quill.color)\nplot(copper.data$Per_Weight~copper.data$Bucket, col = copper.data$Species_Seq, lwd = 5, \n     pch = 20, bty = \"l\", ylab = \"Percent Weight Change\", \n     xlab = \"Temperature\", main = \"Copper Rockfish Experiment\")\n#what fit would I add to the graph?\n```\n\n### Model Them Separately\n```{r}\n\n# Subset Species Data\n  copper.data.2 <- subset(copper.data, copper.data$Species_Seq == \"Copper\")\n  quillback.data <- subset(copper.data, copper.data$Species_Seq == \"Quillback\")\n  \n# Model Quillback \n  qb.mod1 <- lm(quillback.data$Per_Weight~quillback.data$Bucket \n                  + quillback.data$Start_Weight)\n  summary(qb.mod1)\n  drop1(qb.mod1)\n\n# Model Copper\n  cop.mod1 <- lm(copper.data.2$Per_Weight~copper.data.2$Bucket \n                  + copper.data.2$Start_Weight)\n  summary(cop.mod1)\n\n#Copper Rockfish Experiment Plots\n plot(copper.data.2$Per_Weight~copper.data.2$Bucket, col = \"orange\",\n       lwd = 5, pch = 20, bty = \"l\", ylab = \"Percent Weight Change\", \n     xlab = \"Temperature\", main = \"Copper Rockfish Experiment\")\n points(quillback.data$Per_Weight~quillback.data$Bucket, col = \"brown\",\n        lwd = 5, pch = 20)\n legend(\"topright\", legend = c(\"Copper\", \"Quillback\"), \n         pch = c(20, 20), col = c(\"orange\", \"brown\"))\n\n```\n",
    "created" : 1512398745857.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "273|6|291|0|\n294|6|325|0|\n329|6|349|0|\n352|6|378|0|\n",
    "hash" : "1573495002",
    "id" : "BFDD4EB6",
    "lastKnownWriteTime" : 1557762161,
    "last_content_update" : 1557762161150,
    "path" : "~/Documents/Northeastern/LotterhosLab/Research/Field_Work/2015/TPC_Experiment/Analysis/scripts/Species_Growth.Rmd",
    "project_path" : "scripts/Species_Growth.Rmd",
    "properties" : {
        "chunk_output_type" : "console"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}