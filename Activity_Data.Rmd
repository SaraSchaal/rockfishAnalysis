---
title: "Activity_Data"
author: "Sara Michele Schaal"
date: "6/2/2017"
output:
  html_document: default
  pdf_document: default
---

## Load Relevant Packages
```{r, echo=FALSE}
    if(!("plyr" %in% installed.packages())){
      install.packages("plyr")
    }
    if(!("dplyr" %in% installed.packages())){
      install.packages("dplyr")
    }
    if(!("ggplot2" %in% installed.packages())){
      install.packages("ggplot2")
    }
    if(!("scales" %in% installed.packages())){
      install.packages("scales")
    }
    if(!("sm" %in% installed.packages())){
      install.packages("sm")
    }
    if(!("ggpubr" %in% installed.packages())){
      install.packages("ggpubr")
    }
    library(plyr)
    library(dplyr)
    library(ggplot2)
    library(scales)
    library(ggpubr)
    library(sm)
    
```

# Data Manipulation
## Read in data and calculate means
```{r}

## Read in data ##
  full.act <- read.csv("data/Activity/20171129_ActivityData.csv")
  black.temps <- read.csv("data/black_exp_temps.csv")
  copper.temps <- read.csv("data/copper_exp_temps.csv")

  # Subset data into two experiments  
  black.act <- full.act[full.act$Species == "Black", ]
  copper.act <- full.act[full.act$Species == "Copper", ]
  
  # Reorder data to be in numerical ascending order 
  # **(only way for loop to work properly)
  black.temps.asc <- black.temps[order(black.temps$Bucket), ]
  copper.temps.asc <- copper.temps[order(copper.temps$Bucket_ID), ]
  
  # Fill in actual mean temperature data from experiment
  # BY complex
  for(i in 1:16){
    for(j in 1:nrow(black.act)){
      if(black.act$Bucket[j] == i){
        black.act$Temperature[j] <- black.temps.asc$mean[i]
      }
    }
  }
  
  # CQ complex
  for(i in 1:16){
    for(j in 1:nrow(copper.act)){
      if(copper.act$Bucket[j] == i){
        copper.act$Temperature[j] <- copper.temps.asc$mean[i]
      }
    }
  }

  
  # take the mean of the two watches of the same fish per viewer
  black.act$Act_Mean_Julia <- rowMeans(black.act[, 8:9])
  black.act$Act_Mean_Sandi <- rowMeans(black.act[, 10:11])
  copper.act$Act_Mean_Julia <- rowMeans(copper.act[,8:9])
  copper.act$Act_Mean_Sandi <- rowMeans(copper.act[,10:11])
  
``` 

## Calculate averages per bucket per timepoint
```{r}

### Black Rockfish ###

    # create empty data frames for mean bucket activity values
    Mean.Activity <- matrix(NA, nrow(unique(black.act[c("Date", "AM_PM", "Bucket")])),4)
    bucket.act.average <- unique(black.act[c("Date", "AM_PM", "Bucket", "Temperature")])
    complete.act.data <- cbind(bucket.act.average, Mean.Activity)
    colnames(complete.act.data) <- c("Date", "AM_PM", "Bucket", "Temperature", 
                                     "mean.julia", "mean.sandi", "mean.both", "FishAlive")
    
    # initialize the vectors that will be used in the forloop ** NOTE data in these 
    # vectors is written over in each loop.. they are TEMPORARY vectors **
    bucket.act.julia <- NULL
    bucket.act.sandi <- NULL
    bucket.act.both <- NULL
    
    # initialize the counter for stepping through the output matrix
    j <- 1
    # For loop to step through data frame to get activity averages
    for(i in 1:nrow(black.act)){
      
      # looping through majority of data to grab all those rows that are not the last row
      # but are all those that equal the same bucket from the same day and getting 
      # activity averages
      if(i != nrow(black.act) && i == 1 || 
         black.act$Bucket[i] == black.act$Bucket[i-1] && i != nrow(black.act)){
        
        bucket.act.julia <- c(bucket.act.julia, black.act$Act_Mean_Julia[i])
        bucket.act.sandi <- c(bucket.act.sandi, black.act$Act_Mean_Sandi[i])
        bucket.act.both <- c(bucket.act.both, black.act$Act_Mean_Julia[i], black.act$Act_Mean_Sandi[i])
     
        # special case for last row 
       } else {
         if(i == nrow(black.act)){

          # Remove any NAs before taking mean for a bucket at a timepoint
          bucket.act.both.noNA <- bucket.act.both[!is.na(bucket.act.both)]
          bucket.act.julia.noNA <- bucket.act.julia[!is.na(bucket.act.julia)]
          bucket.act.sandi.noNA <- bucket.act.sandi[!is.na(bucket.act.sandi)]
          complete.act.data$mean.julia[j] <- sum(bucket.act.julia.noNA)/length(bucket.act.julia.noNA)
          complete.act.data$mean.sandi[j] <- sum(bucket.act.sandi.noNA)/length(bucket.act.sandi.noNA)
          complete.act.data$mean.both[j] <- sum(bucket.act.both.noNA)/length(bucket.act.both.noNA)
          complete.act.data$FishAlive[j] <- length(bucket.act.sandi.noNA)
          j <- j + 1
          
        } else {
          
          # Remove any NAs before taking mean for a bucket at a timepoint
          bucket.act.both.noNA <- bucket.act.both[!is.na(bucket.act.both)]
          bucket.act.julia.noNA <- bucket.act.julia[!is.na(bucket.act.julia)]
          bucket.act.sandi.noNA <- bucket.act.sandi[!is.na(bucket.act.sandi)]
          
          # Take mean of that bucket for that day and insert into complete.data dataframe
          complete.act.data$mean.julia[j] <- sum(bucket.act.julia.noNA)/length(bucket.act.julia.noNA)
          complete.act.data$mean.sandi[j] <- sum(bucket.act.sandi.noNA)/length(bucket.act.sandi.noNA)
          complete.act.data$mean.both[j] <- sum(bucket.act.both.noNA)/length(bucket.act.both.noNA)
          complete.act.data$FishAlive[j] <- length(bucket.act.sandi.noNA)
          bucket.act.julia <- black.act$Act_Mean_Julia[i]
          bucket.act.sandi <- black.act$Act_Mean_Sandi[i]
          bucket.act.both <- c(black.act$Act_Mean_Julia[i], black.act$Act_Mean_Sandi[i])
          # counter to step through inputting data into the complete.data dataframe
          j <- j + 1
          
        } # close else
       } # close if else
      } # close for loop
    
### Copper Rockfish ###
    
    # create empty data frames for mean bucket activity values
    Mean.Activity.cp <- matrix(NA, nrow(unique(copper.act[c("Date", "AM_PM", "Bucket")])),4)
    bucket.act.average.cp <- unique(copper.act[c("Date", "AM_PM", "Bucket", "Temperature")])
    complete.act.data.cp <- cbind(bucket.act.average.cp, Mean.Activity.cp)
    colnames(complete.act.data.cp) <- c("Date", "AM_PM", "Bucket", "Temperature", 
                                     "mean.julia", "mean.sandi", "mean.both", "FishAlive")
    
    # initialize the vectors that will be used in the for loop ** NOTE data in these vectors is written
    # over in each loop.. they are TEMPORARY vectors **
    bucket.act.julia.cp <- NULL
    bucket.act.sandi.cp <- NULL
    bucket.act.both.cp <- NULL
    
    bucket.act.both.noNA.cp <- NULL
    bucket.act.julia.noNA.cp <- NULL
    bucket.act.sandi.noNA.cp <- NULL
    
    # initialize the counter for stepping through the output matrix
    j <- 1
    i <- 1
    # For loop to step through data frame to get activity averages
    for(i in 1:nrow(copper.act)){
      
      # looping through majority of data to grab all those rows that are not the last row
      # but are all those that equal the same bucket from the same day and getting activity averages
      if(i != nrow(copper.act) && i == 1 || 
         copper.act$Bucket[i] == copper.act$Bucket[i-1] && i != nrow(copper.act)){
        
        bucket.act.julia.cp <- c(bucket.act.julia.cp, copper.act$Act_Mean_Julia[i])
        bucket.act.sandi.cp <- c(bucket.act.sandi.cp, copper.act$Act_Mean_Sandi[i])
        bucket.act.both.cp <- c(bucket.act.both.cp, copper.act$Act_Mean_Julia[i], copper.act$Act_Mean_Sandi[i])
     
        # special case for last row 
       } else {
         if(i == nrow(copper.act)){

          # Remove any NAs before taking mean for a bucket at a timepoint
          bucket.act.both.noNA.cp <- bucket.act.both.cp[!is.na(bucket.act.both.cp)]
          bucket.act.julia.noNA.cp <- bucket.act.julia.cp[!is.na(bucket.act.julia.cp)]
          bucket.act.sandi.noNA.cp <- bucket.act.sandi.cp[!is.na(bucket.act.sandi.cp)]
          complete.act.data.cp$mean.julia[j] <- sum(bucket.act.julia.noNA.cp)/length(bucket.act.julia.noNA.cp)
          complete.act.data.cp$mean.sandi[j] <- sum(bucket.act.sandi.noNA.cp)/length(bucket.act.sandi.noNA.cp)
          complete.act.data.cp$mean.both[j] <- sum(bucket.act.both.noNA.cp)/length(bucket.act.both.noNA.cp)
          complete.act.data.cp$FishAlive[j] <- length(bucket.act.sandi.noNA.cp)
          j <- j + 1
          
        } else {
          
          # Remove any NAs before taking mean for a bucket at a timepoint
          bucket.act.both.noNA.cp <- bucket.act.both.cp[!is.na(bucket.act.both.cp)]
          bucket.act.julia.noNA.cp <- bucket.act.julia.cp[!is.na(bucket.act.julia.cp)]
          bucket.act.sandi.noNA.cp <- bucket.act.sandi.cp[!is.na(bucket.act.sandi.cp)]
          
          # Take mean of that bucket for that day and insert into complete.data dataframe
          complete.act.data.cp$mean.julia[j] <- sum(bucket.act.julia.noNA.cp)/length(bucket.act.julia.noNA.cp)
          complete.act.data.cp$mean.sandi[j] <- sum(bucket.act.sandi.noNA.cp)/length(bucket.act.sandi.noNA.cp)
          complete.act.data.cp$mean.both[j] <- sum(bucket.act.both.noNA.cp)/length(bucket.act.both.noNA.cp)
          complete.act.data.cp$FishAlive[j] <- length(bucket.act.sandi.noNA.cp)
          bucket.act.julia.cp <- copper.act$Act_Mean_Julia[i]
          bucket.act.sandi.cp <- copper.act$Act_Mean_Sandi[i]
          bucket.act.both.cp <- c(copper.act$Act_Mean_Julia[i], copper.act$Act_Mean_Sandi[i])
          # counter to step through inputting data into the complete.data dataframe
          j <- j + 1
          
        } # close else
       } # close if else
      } # close for loop
    
```

## Create a column for Days Since the Start of Experiment
```{r}

### Black Rockfish ###
  # make column for days since start of experiment for panel headers
  complete.act.data$Days_Since_Start <- NA
  
  # add a column that is Date with time of day
  complete.act.data$Date <- as.factor(complete.act.data$Date)
  complete.act.data$Date_Time <- as.factor(paste(complete.act.data$Date, complete.act.data$AM_PM))
   
  # Round temperature data to one significant figure after decimal place
  complete.act.data$RTemperature <- round(complete.act.data$Temperature, 1)
  complete.act.data$DayNum <- NA
  # add in days since start of experiment column
  for(i in 1:length(complete.act.data$Days_Since_Start)){
    if (complete.act.data$Date_Time[i] == "20150623 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 4 AM"
      complete.act.data$DayNum[i] <- 1
    } else if (complete.act.data$Date_Time[i] == "20150624 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 5 PM"
      complete.act.data$DayNum[i] <- 2
    } else if (complete.act.data$Date_Time[i] == "20150625 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 6 AM"
      complete.act.data$DayNum[i] <- 3
    } else if (complete.act.data$Date_Time[i] == "20150625 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 6 PM"
      complete.act.data$DayNum[i] <- 3.5
    } else if (complete.act.data$Date_Time[i] == "20150626 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 7 AM"
      complete.act.data$DayNum[i] <- 4
    } else if (complete.act.data$Date_Time[i] == "20150626 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 7 PM"
      complete.act.data$DayNum[i] <- 4.5
    } else if (complete.act.data$Date_Time[i] == "20150627 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 8 AM"
      complete.act.data$DayNum[i] <- 5
    } else if (complete.act.data$Date_Time[i] == "20150627 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 8 PM"
      complete.act.data$DayNum[i] <- 5.5
    } else if (complete.act.data$Date_Time[i] == "20150628 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 9 AM"
      complete.act.data$DayNum[i] <- 6
    } else if (complete.act.data$Date_Time[i] == "20150628 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 9 PM"
      complete.act.data$DayNum[i] <- 6.5
    } else if (complete.act.data$Date_Time[i] == "20150629 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 10 AM"
      complete.act.data$DayNum[i] <- 7
    } else if (complete.act.data$Date_Time[i] == "20150629 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 10 PM"
      complete.act.data$DayNum[i] <- 7.5
    } else if (complete.act.data$Date_Time[i] == "20150630 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 11 AM"
      complete.act.data$DayNum[i] <- 8
    } else if (complete.act.data$Date_Time[i] == "20150630 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 11 PM"
      complete.act.data$DayNum[i] <- 8.5
    } else if (complete.act.data$Date_Time[i] == "20150702 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 13 AM"
      complete.act.data$DayNum[i] <- 10
    } else if (complete.act.data$Date_Time[i] == "20150702 PM"){
      complete.act.data$Days_Since_Start[i] <- "Day 13 PM"
      complete.act.data$DayNum[i] <- 10.5
    } else if(complete.act.data$Date_Time[i] == "20150703 AM"){
      complete.act.data$Days_Since_Start[i] <- "Day 14 AM"
      complete.act.data$DayNum[i] <- 11
  }
}
### Copper Rockfish ###
  # Make column for Day Since Start of Experiment
  complete.act.data.cp$Days_Since_Start <- NA
  
  # add a column for date time unique combinations
  complete.act.data.cp$Date <- as.factor(complete.act.data.cp$Date)
  complete.act.data.cp$Date_Time <- as.factor(paste(complete.act.data.cp$Date, complete.act.data.cp$AM_PM))
  #complete.act.data.cp[157,9] <- "Day 10 AM" #I am not sure why this single value is going in wrong
  #complete.act.data.cp[157,10] <- "20150714 AM"
   
  # Round temperature data to one significant figure after decimal place
   complete.act.data.cp$RTemperature <- round(complete.act.data.cp$Temperature, 1)
   complete.act.data.cp$DayNum <- NA
   
  # add in days since start of experiment column
  for(i in 1:length(complete.act.data.cp$Days_Since_Start)){
    if (complete.act.data.cp$Date_Time[i] == "20150709 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 5 AM"
      complete.act.data.cp$DayNum[i] <- 1
    } else if (complete.act.data.cp$Date_Time[i] == "20150709 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 5 PM"
      complete.act.data.cp$DayNum[i] <- 1.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150710 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 6 AM"
      complete.act.data.cp$DayNum[i] <- 2
    } else if (complete.act.data.cp$Date_Time[i] == "20150710 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 6 PM"
      complete.act.data.cp$DayNum[i] <- 2.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150711 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 7 AM"
      complete.act.data.cp$DayNum[i] <- 3
    } else if (complete.act.data.cp$Date_Time[i] == "20150711 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 7 PM"
      complete.act.data.cp$DayNum[i] <- 3.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150712 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 8 AM"
      complete.act.data.cp$DayNum[i] <- 4
    } else if (complete.act.data.cp$Date_Time[i] == "20150712 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 8 PM"
      complete.act.data.cp$DayNum[i] <- 4.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150713 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 9 AM"
      complete.act.data.cp$DayNum[i] <- 5
    } else if (complete.act.data.cp$Date_Time[i] == "20150713 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 9 PM"
      complete.act.data.cp$DayNum[i] <- 5.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150714 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 10 AM"
      complete.act.data.cp$DayNum[i] <- 6
    } else if (complete.act.data.cp$Date_Time[i] == "20150715 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 11 AM"
      complete.act.data.cp$DayNum[i] <- 7
    } else if (complete.act.data.cp$Date_Time[i] == "20150715 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 11 PM"
      complete.act.data.cp$DayNum[i] <- 7.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150716 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 12 AM"
      complete.act.data.cp$DayNum[i] <- 8
    } else if (complete.act.data.cp$Date_Time[i] == "20150716 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 12 PM"
      complete.act.data.cp$DayNum[i] <- 8.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150717 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 13 AM"
      complete.act.data.cp$DayNum[i] <- 9
    } else if (complete.act.data.cp$Date_Time[i] == "20150717 PM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 13 PM"
      complete.act.data.cp$DayNum[i] <- 9.5
    } else if (complete.act.data.cp$Date_Time[i] == "20150718 AM"){
      complete.act.data.cp$Days_Since_Start[i] <- "Day 14 AM"
      complete.act.data.cp$DayNum[i] <- 10
    }
  }

```

# PLOTTING 
## Panel Plot Activity Across Time for each temperature and Every Date (NOT USING)
```{r}
  library(ggplot2)
  # ggplot to look at activity across time across bucket treatments
   bucket.plot <- ggplot(data=complete.act.data, 
                         aes(x=DayNum, y=mean.both, 
                            group=as.factor(RTemperature), 
                            color = as.factor(RTemperature))) + geom_point() + geom_smooth(method = "lm")
   
   bucket.plot + facet_wrap(~RTemperature) + labs(y = "Mean Activity") + 
     scale_color_discrete(name = "Temperature") + 
     ggtitle("Black Rockfish Activity Per Bucket Across Time")
   
   bucket.plot + facet_wrap(~RTemperature) + labs(y = "Mean Activity", x = "Temperature") + 
     scale_color_gradient(low = "gainsboro", high = "black", name = "Temperature") + 
     theme_bw() +
     theme(panel.border = element_blank(), panel.grid.major = element_blank(),
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"),
           legend.position = "none") + 
     scale_x_continuous("DayNum", breaks = pretty_breaks(), limits = c(0,11)) +
     ggtitle("Black Rockfish Activity Per Bucket Across Time")
   
    
  # ggplot to look at activity across time across bucket treatments
   bucket.plot.cp <- ggplot(data=complete.act.data.cp, 
                         aes(x=Date_Time, y=mean.both, 
                            group=as.factor(RTemperature), 
                            color = as.factor(RTemperature))) + geom_point() + geom_smooth(method = "lm")
  # Create Plot
   bucket.plot.cp + facet_wrap(~RTemperature) + labs(y = "Mean Activity") + 
     scale_color_discrete(name = "Temperature") + 
     ggtitle("Copper Rockfish Activity Per Bucket Across Time")
   
   bucket.plot + facet_wrap(~RTemperature) + labs(y = "Mean Activity", x = "Temperature") + 
     scale_color_gradient(low = "gainsboro", high = "black", name = "Temperature") + 
     theme_bw() +
     theme(panel.border = element_blank(), panel.grid.major = element_blank(),
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"),
           legend.position = "none") + 
     scale_x_continuous("DayNum", breaks = pretty_breaks(), limits = c(0,11)) +
     ggtitle("Black Rockfish Activity Per Bucket Across Time")

```

## Average Activity Across Entire Experiment (Single Figure) (NOT USING)
```{r}

## Bucket averages across experiment 
   mean.black.activity <- aggregate(complete.act.data$mean.both,list(complete.act.data$RTemperature), mean)
   colnames(mean.black.activity) <- c("Temperature", "Mean_Activity")
   
   mean.copper.activity <- aggregate(complete.act.data.cp$mean.both, list(complete.act.data.cp$RTemperature), mean)
   colnames(mean.copper.activity) <- c("Temperature", "Mean_Activity")
   
  # Plot averages
   par(mfrow = c(1,2))
   plot(mean.black.activity$Temperature, mean.black.activity$Mean_Activity, ylim = c(0,4),
        xlab = "Temperature", ylab = "Mean Activity", pch = 19, bty = "l",
        main = "Black Rockfish Activity")

   plot(mean.copper.activity$Temperature, mean.copper.activity$Mean_Activity, 
        ylim = c(0,4), xlab = "Temperature", ylab = "Mean Activity", 
        pch = 19, bty = "l", col = "orange",
        main = "Copper Rockfish Activity")
   
```

## Panel Plot Activity Across Temperatures for Every Date
```{r}
################################################################
#### Factor Days ###############################################
#### to change to correct order for plotting the panel plot ####
################################################################
### black
  b.unique_Days <- c("Day 4 AM", "Day 5 PM", "Day 6 AM", "Day 6 PM", "Day 7 AM", "Day 7 PM", 
                      "Day 8 AM", "Day 8 PM", "Day 9 AM", "Day 9 PM", "Day 10 AM", "Day 10 PM", 
                      "Day 11 AM", "Day 11 PM", "Day 13 AM", "Day 13 PM", "Day 14 AM")
  complete.act.data$Days_Since_Start <- as.factor(complete.act.data$Days_Since_Start)
  complete.act.data$Days_Since_Start <- factor(complete.act.data$Days_Since_Start, 
                                               levels = b.unique_Days)
### copper
   c.unique_Days <- c("Day 5 AM", "Day 5 PM", "Day 6 AM", "Day 6 PM", "Day 7 AM", "Day 7 PM",  
                       "Day 8 AM", "Day 8 PM", "Day 9 AM", "Day 9 PM", "Day 10 AM", "Day 11 AM", 
                       "Day 11 PM", "Day 12 AM", "Day 12 PM", "Day 13 AM", "Day 13 PM", "Day 14 AM")
   complete.act.data.cp$Days_Since_Start <- as.factor(complete.act.data.cp$Days_Since_Start)
   complete.act.data.cp$Days_Since_Start <- factor(complete.act.data.cp$Days_Since_Start, 
                                                   levels = c.unique_Days)


#############################
#### Black Rockfish Plot ####
############################# 
  # Save plot
    day.plot <- ggplot(data=complete.act.data, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                       geom_point(aes(size = complete.act.data$FishAlive), alpha = 0.8) + 
                       geom_smooth(method = "lm", se = FALSE) 
    
  # Create plot 
   bAll.panel <- day.plot + facet_wrap(~Days_Since_Start) +
     labs(y = "Mean Activity", x = "Temperature") +
     scale_color_gradient(low = "gainsboro", high = "black", name = "Time") + 
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"),
           legend.position = "none") + 
     scale_x_continuous(breaks = pretty_breaks()) + 
     #scale_size(range = c(1,3))
     scale_radius(NULL, NULL)
   
##############################
#### Copper Rockfish Plot ####
############################## 
  # Save plot
   day.plot.cp <- ggplot(data=complete.act.data.cp, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                  geom_point(aes(size = complete.act.data.cp$FishAlive), alpha = 0.8) + 
                  geom_smooth(method = "lm", se = FALSE) 
  # Create plot
   cpAll.panel <- day.plot.cp + facet_wrap(~Days_Since_Start) + 
     labs(y = "Mean Activity", x = "Temperature") + 
     scale_color_gradient(low = "gainsboro", high = "darkorange", name = "Time") + 
     scale_x_continuous(NULL) +
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"), 
           legend.position = "none")  +
     scale_radius(NULL, NULL)

####################################
#### Black Rockfish Single Plot ####
####################################
  # Create plot
   bAll.single <- day.plot + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "black", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 PM", "Day 8 AM", "Day 10 PM", "Day 13 PM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(),
         axis.line = element_line(colour = "black")) +
   scale_radius(breaks = c(1,2,3,4), name = "# Fish Alive", limits = c(1,4))  +
   guides(color = guide_colourbar(order = 1),
          size = guide_legend(order = 2))
   
#####################################
#### Copper Rockfish Single Plot ####
#####################################
  # Create plot
   cpAll.single <- day.plot.cp + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "darkorange", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 PM", "Day 8 AM", "Day 10 AM", "Day 13 PM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(), 
         axis.line = element_line(colour = "black")) +
   scale_radius(NULL, NULL) 
   
   ggarrange(bAll.panel, bAll.single, cpAll.panel, cpAll.single, labels = (c("A", "B", "C", "D")))

```

## Morning Data Only (NOT USING)
```{r}

#####################
#### Subset Data ####
#####################

black.AM <- complete.act.data[complete.act.data$AM_PM == "AM",]
copper.AM <- complete.act.data.cp[complete.act.data.cp$AM_PM == "AM",]

#############################
#### Black Rockfish Plot ####
############################# 
  # Save plot
    day.plot.AM <- ggplot(data=black.AM, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                       geom_point(aes(size = black.AM$FishAlive), alpha = 0.8) + 
                       geom_smooth(method = "lm", se = FALSE) 
    
  # Create plot 
   bAM.panel <- day.plot.AM + facet_wrap(~Days_Since_Start) +
     labs(y = "Mean Activity", x = "Temperature") +
     scale_color_gradient(low = "gainsboro", high = "black", name = "Time") + 
     scale_x_continuous(NULL) +
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"),
           legend.position = "none") + 
     scale_x_continuous(breaks = pretty_breaks()) + 
     #scale_size(range = c(1,3))
     scale_radius(NULL, NULL)
   
##############################
#### Copper Rockfish Plot ####
############################## 
  # Save plot
   day.plot.cp.AM <- ggplot(data=copper.AM, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                  geom_point(aes(size = copper.AM$FishAlive), alpha = 0.8) + 
                  geom_smooth(method = "lm", se = FALSE) 
  # Create plot
   cpAM.panel <- day.plot.cp.AM + facet_wrap(~Days_Since_Start) + 
     labs(y = "Mean Activity", x = "Temperature") + 
     scale_color_gradient(low = "gainsboro", high = "darkorange", name = "Time") + 
     scale_x_continuous(NULL) +
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"), 
           legend.position = "none")  +
     scale_radius(NULL, NULL)

####################################
#### Black Rockfish Single Plot ####
####################################
  # Create plot
   bAM.single <- day.plot.AM + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "black", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 AM", "Day 8 AM", "Day 10 AM", "Day 13 AM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(),
         axis.line = element_line(colour = "black")) +
   scale_radius(breaks = c(1,2,3,4), name = "# Fish Alive", limits = c(1,4))  +
   guides(color = guide_colourbar(order = 1),
          size = guide_legend(order = 2))
   
#####################################
#### Copper Rockfish Single Plot ####
#####################################
  # Create plot
   cpAM.single <- day.plot.cp.AM + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "darkorange", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 AM", "Day 8 AM", "Day 10 AM", "Day 13 AM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(), 
         axis.line = element_line(colour = "black")) +
   scale_radius(NULL, NULL) 
   
   ggarrange(bAM.panel, bAM.single, cpAM.panel, cpAM.single, labels = (c("A", "B", "C", "D")))


```

## Evening Data Only (NOT USING)
```{r}
#####################
#### Subset Data ####
#####################

black.PM <- complete.act.data[complete.act.data$AM_PM == "PM",]
copper.PM <- complete.act.data.cp[complete.act.data.cp$AM_PM == "PM",]

#############################
#### Black Rockfish Plot ####
############################# 
  # Save plot
    day.plot.PM <- ggplot(data=black.PM, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                       geom_point(aes(size = black.PM$FishAlive), alpha = 0.8) + 
                       geom_smooth(method = "lm", se = FALSE) 
    
  # Create plot 
   bPM.panel <- day.plot.PM + facet_wrap(~Days_Since_Start) +
     labs(y = "Mean Activity", x = "Temperature") +
     scale_color_gradient(low = "gainsboro", high = "black", name = "Time") + 
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"),
           legend.position = "none") + 
     scale_x_continuous(breaks = pretty_breaks()) + 
     #scale_size(range = c(1,3))
     scale_radius(NULL, NULL)
   
##############################
#### Copper Rockfish Plot ####
############################## 
  # Save plot
   day.plot.cp.PM <- ggplot(data=copper.PM, 
                         aes(x=RTemperature, y=mean.both, 
                            group=as.factor(Days_Since_Start), 
                            color = as.integer(Date_Time))) + 
                  geom_point(aes(size = copper.PM$FishAlive), alpha = 0.8) + 
                  geom_smooth(method = "lm", se = FALSE) 
  # Create plot
   cpPM.panel <- day.plot.cp.PM + facet_wrap(~Days_Since_Start) + 
     labs(y = "Mean Activity", x = "Temperature") + 
     scale_color_gradient(low = "gainsboro", high = "darkorange", name = "Time") + 
     scale_x_continuous(NULL) +
     theme_bw() + 
     theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
           panel.grid.minor = element_blank(),
           axis.line = element_line(colour = "black"), 
           legend.position = "none")  +
     scale_radius(NULL, NULL)

####################################
#### Black Rockfish Single Plot ####
####################################
  # Create plot
   bPM.single <- day.plot.PM + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "black", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 PM", "Day 8 PM", "Day 10 PM", "Day 13 PM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(),
         axis.line = element_line(colour = "black")) +
   scale_radius(breaks = c(1,2,3,4), name = "# Fish Alive", limits = c(1,4)) + 
   guides(color = guide_colourbar(order = 1),
          size = guide_legend(order = 2))
   
#####################################
#### Copper Rockfish Single Plot ####
#####################################
  # Create plot
   cpPM.single <- day.plot.cp.PM + labs(y = "Mean Activity", x = "Temperature") + 
   scale_color_gradient(low = "gainsboro", high = "darkorange", 
                        name = "Days Since \nStart of \nExperiment", 
                        breaks = c(4, 8, 12, 16), 
                        labels = c("Day 6 PM", "Day 8 PM", "Day 10 PM", "Day 13 PM")) + 
   scale_x_continuous(breaks = pretty_breaks()) +
   theme_bw() + 
   theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
         panel.grid.minor = element_blank(), 
         axis.line = element_line(colour = "black")) +
   scale_radius(NULL, NULL) 
   
   ggarrange(bPM.panel, bPM.single, cpPM.panel, cpPM.single, labels = (c("A", "B", "C", "D")))

```

# Regression Slopes of Activity Across Temperature over Time
```{r}
## black
  # vector of unique days & empty data frames for writing slopes to
   b.slopes <- matrix(ncol = 4, nrow = length(unique(complete.act.data$Days_Since_Start)))
 
  # Create for loop to capture slopes of regression between activity and temp for each date/time
   for(i in 1:length(unique(complete.act.data$Days_Since_Start))){
     b.slopes[i,1] <- lm(mean.both~RTemperature, data = complete.act.data, 
                         subset = Days_Since_Start == b.unique_Days[i])$coefficients[[2]]
     b.slopes[i,2] <-  summary(lm(mean.both~RTemperature, data = complete.act.data, 
                                  subset = Days_Since_Start == b.unique_Days[i]))$coefficients[2,2]
     b.slopes[i,3] <- b.slopes[i,1] - 1.96*b.slopes[i,2]
     b.slopes[i,4] <- b.slopes[i,1] + 1.96*b.slopes[i,2]
   } 
   output <- summary(lm(mean.both~RTemperature, data = complete.act.data, subset = Days_Since_Start == b.unique_Days[2]))
   summary(lm(mean.both~RTemperature, data = complete.act.data, subset = Days_Since_Start == b.unique_Days[3]))$coefficients[2,2]
   
## copper
  # vector of unique days & empty data frames for writing slopes to
   c.slopes <- matrix(ncol = 4, nrow = length(unique(complete.act.data.cp$Days_Since_Start)))
   
  # Create for loop to capture slopes of regression between activity and temp for each date/time
   for (i in 1:length(unique(complete.act.data.cp$Days_Since_Start))){
     c.slopes[i] <- lm(mean.both~RTemperature, data = complete.act.data.cp, 
                      subset = Days_Since_Start == c.unique_Days[i])$coefficients[[2]]
     c.slopes[i,2] <-  summary(lm(mean.both~RTemperature, data = complete.act.data.cp, 
                                  subset = Days_Since_Start == c.unique_Days[i]))$coefficients[2,2]
     c.slopes[i,3] <- c.slopes[i,1] - 1.96*c.slopes[i,2]
     c.slopes[i,4] <- c.slopes[i,1] + 1.96*c.slopes[i,2]
   } 

## Create plot of days since start vs slope of the activity~temp regression
  # number unique days for scatterplot .5 increments indicate PM measurements integers are AM
   b.unique_Days_num <- c(4, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 13, 13.5, 14)
   c.unique_Days_num <- c(5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 11, 11.5, 12, 12.5, 13, 13.5, 14)
   
  # plot
   par(mfrow = c(1,2))
   plot(b.slopes[ ,1]~b.unique_Days_num, type = "l", 
        ylim = c(min(c.slopes)-0.05, max(c.slopes)+0.05), 
        lwd = 2, bty = "l", ylab= "Activity vs Temperature Regression Slope",
        xlab = "Day of Experiment")
   points(b.slopes[ ,3]~b.unique_Days_num, type = "l", col = "grey")
   points(b.slopes[ ,4]~b.unique_Days_num, type = "l", col = "grey")
   abline(0,0, lty = 2)
   legend("topleft", legend = c("BY Complex", "CQ complex"), col = c("black", "orange"), lwd = 2)
   mtext(text = "A", side = 3, adj = 0.01, padj = 0.01)

   plot(c.slopes[ ,1]~c.unique_Days_num, type = "l", lwd = 2, col = "orange", 
        bty = "l", ylim = c(min(c.slopes)-0.05, max(c.slopes)+0.05), 
        ylab = NA, xlab = "Day of Experiment")
   points(c.slopes[ ,3]~c.unique_Days_num, type = "l", col = "grey")
   points(c.slopes[ ,4]~c.unique_Days_num, type = "l", col = "grey")
   abline(0,0, lty = 2)
   mtext(text = "B", side = 3, adj = 0.01, padj = 0.01)

  
   
```

# Regression Slopes of Activity Across Time Per Temperature
```{r}
## black
  b.unique_Temp <- sort(unique(complete.act.data$RTemperature))
   
  # vector of unique days & empty data frames for writing slopes to
   ttb.slopes <- matrix(ncol = 4, nrow = length(unique(complete.act.data$RTemperature)))
   
   prac <- subset(complete.act.data, subset = complete.act.data$RTemperature == 22.6)
   prac$DateNum <- c(1:17)
   plot(mean.both~DateNum, data = prac)
   abline(lm(mean.both~DateNum, data = prac))
   summary(lm(mean.both~DateNum, data = prac))
   
  # Create for loop to capture slopes of regression between activity and temp for each date/time
   for (i in 1:length(unique(complete.act.data$RTemperature))){
     ttb.slopes[i,1] <- lm(mean.both~as.numeric(DateTimePOS), data = complete.act.data, 
                         subset = RTemperature == b.unique_Temp[i])$coefficients[[2]]
     ttb.slopes[i,2] <-  summary(lm(mean.both~as.numeric(DateTimePOS), data = complete.act.data, 
                                  subset = RTemperature == b.unique_Temp[i]))$coefficients[2,2]
     ttb.slopes[i,3] <- ttb.slopes[i,1] - 1.96*ttb.slopes[i,2]
     ttb.slopes[i,4] <- ttb.slopes[i,1] + 1.96*ttb.slopes[i,2]
   } 
   
## copper
   
   c.unique_Temp <- sort(unique(complete.act.data.cp$RTemperature))
  # vector of unique days & empty data frames for writing slopes to
   ttc.slopes <- matrix(ncol = 4, nrow = length(unique(complete.act.data.cp$RTemperature)))
   
  # Create for loop to capture slopes of regression between activity and temp for each date/time
   for (i in 1:length(unique(complete.act.data.cp$RTemperature))){
     ttc.slopes[i] <- lm(mean.both~as.numeric(DateTimePOS), data = complete.act.data.cp, 
                      subset = RTemperature == c.unique_Temp[i])$coefficients[[2]]
     ttc.slopes[i,2] <-  summary(lm(mean.both~as.numeric(DateTimePOS), data = complete.act.data.cp, 
                                  subset = RTemperature == c.unique_Temp[i]))$coefficients[2,2]
     ttc.slopes[i,3] <- ttc.slopes[i,1] - 1.96*ttc.slopes[i,2]
     ttc.slopes[i,4] <- ttc.slopes[i,1] + 1.96*ttc.slopes[i,2]
   } 

## Create plot of days since start vs slope of the activity~temp regression
  # number unique days for scatterplot .5 increments indicate PM measurements integers are AM
   b.unique_Days_num <- c(4, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 13, 13.5, 14)
   c.unique_Days_num <- c(5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 11, 11.5, 12, 12.5, 13, 13.5, 14)
   
  # plot
   par(mfrow = c(1,2))
   plot(ttb.slopes[ ,1]~b.unique_Temp, type = "l", 
        lwd = 2, bty = "l", ylab= "Activity vs Day Regression Slope",
        xlab = "Temperature", ylim = c(-0.3, 0.2))
   points(ttb.slopes[ ,3]~ttb.unique_Days_num, type = "l", col = "grey")
   points(ttb.slopes[ ,4]~ttb.unique_Days_num, type = "l", col = "grey")
   abline(0,0, lty = 2)
   
   plot(ttc.slopes[ ,1]~c.unique_Temp, type = "l", lwd = 2, col = "orange", 
        bty = "l", ylim = c(min(ttc.slopes)-0.05, max(ttc.slopes)+0.05), 
        ylab = NA, xlab = "Day of Experiment")
   points(ttc.slopes[ ,3]~c.unique_Days_num, type = "l", col = "grey")
   points(ttc.slopes[ ,4]~c.unique_Days_num, type = "l", col = "grey")
   abline(0,0, lty = 2)
   legend("topright", legend = c("BY Complex", "CQ complex"), col = c("black", "orange"), lwd = 2)
   

```

# ANALYSIS 
## Negative Exponential (NOT USING)
```{r}

# Set Variables
    x <- mean.black.activity$Temperature
    y <- mean.black.activity$Mean_Activity
    b <- 4
    m <- 0.01
    #y = b - exp(m*x)
    
# Build Model
    m1 <- nls(y~b-exp(m*x), start = c(b = b, m = m))
    
# Goodness of fit
    cor(y,predict(m1))

# Plot data with nls predicted fit
    plot(mean.black.activity$Temperature, mean.black.activity$Mean_Activity, ylim = c(0,4),
          xlab = "Temperature", ylab = "Mean Activity", pch = 19, bty = "l",
          main = "Black Rockfish Activity")
    lines(x,predict(m1),col="black",lty=1,lwd=2)
    text(14, 1, labels = "0.05 +/- 0.0082***")
    text(14, 0.7, labels = "y ~ b - exp(m*x)")
    summary(m1)

#######################
### Copper Rockfish ###
#######################
    
 # Set Variables
    xx <- mean.copper.activity$Temperature
    yy <- mean.copper.activity$Mean_Activity
    bb <- 3.5
    mm <- 0.01
    #y = b - exp(m*x)
    
 # Build Model
    m1.cp <- nls(yy~bb-exp(mm*xx), start = c(bb = bb, mm = mm))
    
 # Goodness of fit
    cor(yy,predict(m1.cp))
       
 # Plot data with nls Predicted fit   
     plot(mean.copper.activity$Temperature, mean.copper.activity$Mean_Activity, 
        ylim = c(0,4), xlab = "Temperature", ylab = "Mean Activity", 
        pch = 19, bty = "l", col = "orange",
        main = "Copper Rockfish Activity")
    lines(xx,predict(m1.cp),col="orange",lty=1,lwd=2)
    text(14, 1, labels = "0.0499 +/- 0.0090***")
    text(14, 0.7, labels = "y ~ b - exp(m*x)")
    summary(m1.cp)

```

## General Linearized Models (GLMs) (NOT USING)
```{r}

blk.act.m1 <- lm(complete.act.data$mean.both~complete.act.data$Temperature + complete.act.data$Date_Time + complete.act.data$Temperature*complete.act.data$Date_Time)
summary(aov(blk.act.m1))

blk.act.m2 <- lm(complete.act.data$mean.both~complete.act.data$Temperature + complete.act.data$Date_Time)
summary(aov(blk.act.m2))
summary(blk.act.m2) 


cop.act.m1 <- lm(complete.act.data.cp$mean.both~complete.act.data.cp$Temperature + complete.act.data.cp$Date_Time + complete.act.data.cp$Temperature*complete.act.data.cp$Date_Time)
summary(aov(cop.act.m1)) # why isn't the interaction significant??

drop1(cop.act.m1)
cop.act.m2 <- lm(complete.act.data.cp$mean.both~complete.act.data.cp$Temperature + complete.act.data.cp$Date_Time)
summary(cop.act.m2)



```

## Edit date/time to be in POSIX form
```{r}
library(plyr)
#Inspect data elements
str(complete.act.data)

# Construct AM/PM to be times
  complete.act.data$AM_PMTime <- complete.act.data$AM_PM
  complete.act.data$AM_PMTime <- revalue(complete.act.data$AM_PMTime, 
                                         c("AM" = "09:00:00", "PM" = "18:00:00"))
  
  complete.act.data.cp$AM_PMTime <- complete.act.data.cp$AM_PM
  complete.act.data.cp$AM_PMTime <- revalue(complete.act.data.cp$AM_PMTime, 
                                            c("AM" = "09:00:00", "PM" = "18:00:00"))
# Create POSIX
  # black
  complete.act.data$DateTimePOS <- as.POSIXlt(paste(as.Date(as.character(complete.act.data$Date),
                                                            format = ("%Y%m%d")),
                                                    as.character(complete.act.data$AM_PMTime)))
  # copper
  complete.act.data.cp$DateTimePOS <- as.POSIXlt(paste(as.Date(as.character(complete.act.data.cp$Date), 
                                                               format = ("%Y%m%d")),
                                                       as.character(complete.act.data.cp$AM_PMTime)))
```

## Run models for full dataset with Species as a factor
```{r}
##################################
#### Data Manipulation ###########
### Combine Species DataFrames ###
  species <- rep("Black", 259)
  species.cp <- rep("Copper", 271)
  complete.act.data.sp <- cbind(complete.act.data, species)
  complete.act.data.cp.sp <- cbind(complete.act.data.cp, species.cp)
  colnames(complete.act.data.cp.sp)[15] <- "species"
  full.act.data <- rbind(complete.act.data.sp,complete.act.data.cp.sp)
  
################################################
#### Models ####################################
### Full Model: species*temp*time 3-way interaction
  species.act.m1 <- lm(full.act.data$mean.both ~
                         full.act.data$Temperature*as.numeric(full.act.data$DateTimePOS)*full.act.data$species)
    summary(species.act.m1)
    summary(aov(species.act.m1))
    hist(full.act.data$mean.both)
   
## Test Assumptions  
  # Autocorrelation: Because this is a repeated measures 
  acf(species.act.m1$residuals) # No autocorrelation
  par(mfrow = c(2,2))
  plot(species.act.m1)
  qqnorm(species.act.m1$residuals)
  qqline(species.act.m1$residuals)
  hist(species.act.m1$residuals)
  shapiro.test(species.act.m1$residuals)
  blk <- full.act.data[full.act.data$species == "Black", ]
  hist(blk$mean.both)
  cp <- full.act.data[full.act.data$species == "Copper", ]
  hist(cp$mean.both)

# Log 10 - Does not improve
  species.act.m1Log <- lm(log10(full.act.data$mean.both + 10) ~
                         full.act.data$Temperature*as.numeric(full.act.data$DateTimePOS)*full.act.data$species)
  summary(species.act.m1Log)
  summary(aov(species.act.m1Log))
  
  # Assumptions
  par(mfrow = c(2,2))
  plot(species.act.m1Log)
  par(mfrow = c(1,1))
  qqnorm(species.act.m1Log$residuals)
  qqline(species.act.m1Log$residuals)
  hist(species.act.m1Log$residuals)
  shapiro.test(species.act.m1Log$residuals)
  
## Square Root - Makes it way worse
  species.act.m1SR <- lm(sqrt(full.act.data$mean.both) ~
                         full.act.data$Temperature*as.numeric(full.act.data$DateTimePOS)*full.act.data$species)
  summary(species.act.m1SR)
  summary(aov(species.act.m1SR))
  
  # Assumptions
  par(mfrow = c(2,2))
  plot(species.act.m1SR)
  par(mfrow = c(1,1))
  qqnorm(species.act.m1SR$residuals)
  qqline(species.act.m1SR$residuals)
  hist(species.act.m1SR$residuals)
  shapiro.test(species.act.m1SR$residuals)
  
## Square
  species.act.m1SQ <- lm((full.act.data$mean.both)^2 ~
                         full.act.data$Temperature*as.numeric(full.act.data$DateTimePOS)*full.act.data$species)
  summary(species.act.m1SQ)
  summary(aov(species.act.m1SQ))
  
  # Assumptions
  par(mfrow = c(2,2))
  plot(species.act.m1SQ)
  par(mfrow = c(1,1))
  qqnorm(species.act.m1SQ$residuals)
  qqline(species.act.m1SQ$residuals)
  hist(species.act.m1SQ$residuals)
  shapiro.test(species.act.m1SQ$residuals)
  
  
 
### Second Model Set: Time*Species & Temp*Species
  species.act.m2 <- lm((full.act.data$mean.both)^2~as.numeric(full.act.data$DateTimePOS)*full.act.data$species)
  summary(species.act.m2)
  summary(aov(species.act.m2))
  par(mfrow = c(2,2))
  plot(species.act.m2)
  hist(species.act.m2$residuals)
  shapiro.test(species.act.m2$residuals)
  
  species.act.m3 <- lm(full.act.data$mean.both~full.act.data$Temperature*full.act.data$species)
  summary(species.act.m3)
  summary(aov(species.act.m3))
  
### Third Model Set: Separate out Species
 ## Black Rockfish
  blk.act.m1 <- lm(complete.act.data$mean.both~complete.act.data$Temperature + 
                     as.numeric(complete.act.data$DateTimePOS) + 
                     complete.act.data$Temperature*as.numeric(complete.act.data$DateTimePOS))
  summary(aov(blk.act.m1))
  summary(blk.act.m1)
  drop1(blk.act.m1)
  
  blk.act.m2 <- lm(complete.act.data$mean.both~complete.act.data$Temperature + as.numeric(complete.act.data$DateTimePOS))
  summary(aov(blk.act.m2))
  drop1(blk.act.m2)
  
 ## Copper Rockfish
  cp.act.m1 <- lm((complete.act.data.cp$mean.both)^2~
                     complete.act.data.cp$Temperature*as.numeric(complete.act.data.cp$DateTimePOS))
  summary(aov(cp.act.m1))
  summary(cp.act.m1)
  qqnorm(cp.act.m1$residuals)
  qqline(cp.act.m1$residuals, col = "red")
  
  shapiro.test(cp.act.m1$residuals)

```


## Monte Carlo
```{r}

####################
#### Full Model ####
####################
alpha <- 0.05  # for 95% confidence interval
bootstrap <- 999
new_act <- numeric(length(bootstrap))
fvalues <- matrix(nrow = 999, ncol = 7)
colnames(fvalues) <- c("Temp", "Time", "Species", "Temp*Time", "Temp*Species", "Time*Species", "Temp*Time*Species")

for(i in 1:bootstrap){
  #new_y <- sample(full.act.data$mean.both, replace = TRUE)
  new_act <- lm(sample(full.act.data$mean.both) ~ sample(full.act.data$Temperature)*sample(as.numeric(full.act.data$DateTimePOS))*sample(full.act.data$species))
  fvalues[i,] <- summary(aov(new_act))[[1]][["F value"]][1:7]
}

fvalues <- as.data.frame(fvalues)
fval.means <- colMeans(fvalues)
lowCI <- numeric(length(ncol(fvalues)))
upCI <- numeric(length(ncol(fvalues)))
for(i in 1:ncol(fvalues)){
  lowCI[i] <- quantile(fvalues[,i], alpha/2, type = 1)
  upCI[i] <- quantile(fvalues[,i], 1-alpha/2, type = 1)
}

mont.carloData <- cbind(fval.means, lowCI, upCI, summary(aov(species.act.m1))[[1]][["F value"]][1:7])
mont.carloData
## A value higher than the upper CI indicates significance 

##########################
#### BY Complex Model ####
##########################
alpha <- 0.05  # for 95% confidence interval
bootstrap <- 999
new_act.by <- numeric(length(bootstrap))
fvalues.by <- matrix(nrow = 999, ncol = 3)
colnames(fvalues.by) <- c("Temp", "Time", "Temp*Time")

for(i in 1:bootstrap){
  #new_y <- sample(full.act.data$mean.both, replace = TRUE)
  new_act.by <- lm(sample(complete.act.data$mean.both)~sample(complete.act.data$Temperature) + 
                     sample(as.numeric(complete.act.data$DateTimePOS)) + 
                     sample(complete.act.data$Temperature*as.numeric(complete.act.data$DateTimePOS)))
  fvalues.by[i,] <- summary(aov(new_act.by))[[1]][["F value"]][1:3]
}

fvalues.by <- as.data.frame(fvalues.by)
fval.means.by <- colMeans(fvalues.by)
lowCI.by <- numeric(length(ncol(fvalues.by)))
upCI.by <- numeric(length(ncol(fvalues.by)))
for(i in 1:ncol(fvalues.by)){
  lowCI.by[i] <- quantile(fvalues.by[,i], alpha/2, type = 1)
  upCI.by[i] <- quantile(fvalues.by[,i], 1-alpha/2, type = 1)
}

mont.carloData.by <- cbind(fval.means.by, lowCI.by, upCI.by, summary(aov(blk.act.m1))[[1]][["F value"]][1:3])
mont.carloData.by

##########################
#### CQ Complex Model ####
##########################
alpha <- 0.05  # for 95% confidence interval
bootstrap <- 999
new_act.cq <- numeric(length(bootstrap))
fvalues.cq <- matrix(nrow = 999, ncol = 3)
colnames(fvalues.cq) <- c("Temp", "Time","Temp*Time")

for(i in 1:bootstrap){
  #new_y <- sample(full.act.data$mean.both, replace = TRUE)
  new_act.cq <- lm(sample(complete.act.data.cp$mean.both)~sample(complete.act.data.cp$Temperature) + 
                     sample(as.numeric(complete.act.data.cp$DateTimePOS)) + 
                     sample(complete.act.data.cp$Temperature*as.numeric(complete.act.data.cp$DateTimePOS)))
  fvalues.cq[i,] <- summary(aov(new_act.cq))[[1]][["F value"]][1:3]
}

fvalues.cq <- as.data.frame(fvalues.cq)
fval.means.cq <- colMeans(fvalues.cq)
lowCI.cq <- numeric(length(ncol(fvalues.cq)))
upCI.cq <- numeric(length(ncol(fvalues.cq)))
for(i in 1:ncol(fvalues.cq)){
  lowCI.cq[i] <- quantile(fvalues.cq[,i], alpha/2, type = 1)
  upCI.cq[i] <- quantile(fvalues.cq[,i], 1-alpha/2, type = 1)
}

mont.carloData.cq <- cbind(fval.means.cq, lowCI.cq, upCI.cq, summary(aov(cp.act.m1))[[1]][["F value"]][1:3])
mont.carloData.cq
```

## Plots to understand interactions
```{r}
##################################################
#### Temperature by Species 2-Way Interaction ####
##################################################

  plot(full.act.data$mean.both[full.act.data$species == "Black"]~
           full.act.data$Temperature[full.act.data$species == "Black"],
       pch = 19, col = "black")
  abline(lm(full.act.data$mean.both[full.act.data$species == "Black"]~
              full.act.data$Temperature[full.act.data$species == "Black"]),
         lwd = 3)
  legend("bottomleft", legend = "BY Complex", pch = 19, cex = 0.8)
  mtext(text = "A", side = 3, adj = 0.01, padj = 0.01)
  plot(full.act.data$mean.both[full.act.data$species == "Copper"]~
         full.act.data$Temperature[full.act.data$species == "Copper"], 
       pch = 19, col = "orange")
  abline(lm(full.act.data$mean.both[full.act.data$species == "Copper"]~
              full.act.data$Temperature[full.act.data$species == "Copper"]), 
         col = "orange", lwd = 3)
  legend("bottomleft", legend = "CQ Complex", pch = 19, 
         col = "orange", cex = 0.8)
  mtext(text = "B", side = 3, adj = 0.01, padj = 0.01)
  mtext("Mean Activity", side = 2, outer = TRUE, cex = 1, line = 2.2)
  mtext(expression(paste('Treatment Temperature (',degree,'C)',sep='')), side = 1, 
        outer = TRUE, cex = 1, line = 2.2)

###########################################
#### Time by Species 2-Way Interaction ####
###########################################
  BY.time <- lm(full.act.data$mean.both[full.act.data$species == "Black"]~
              as.numeric(full.act.data$DateTimePOS[full.act.data$species == "Black"]))
  summary(BY.time)
  CQ.time <- lm(full.act.data$mean.both[full.act.data$species == "Copper"]~
              as.numeric(full.act.data$DateTimePOS[full.act.data$species == "Copper"]))
  summary(CQ.time)
  
 plot(full.act.data$mean.both[full.act.data$species == "Black"]~
           as.numeric(full.act.data$DateTimePOS[full.act.data$species == "Black"]),
       pch = 19, col = "black", xaxt = "n")
 abline(BY.time, lwd = 3)
 axis(1, at = c(1435200000, 1435400000, 1435600000, 1435800000), 
      labels = c("Day 5", "Day 7", "Day 10", "Day 13"))
 #legend("bottomleft", legend = "BY Complex", pch = 19, cex = 0.8)
  mtext(text = "A", side = 3, adj = 0.01, padj = 0.01)
 plot(full.act.data$mean.both[full.act.data$species == "Copper"]~
           as.numeric(full.act.data$DateTimePOS[full.act.data$species == "Copper"]),
       pch = 19, col = "orange", xaxt = "n")
 axis(1, at = c(1436600000, 1436800000, 1437000000, 1437200000), 
      labels = c("Day 5", "Day 7", "Day 10", "Day 13"))
 abline(CQ.time,lwd = 3, col = "orange")
 #legend("bottomleft", legend = "CQ Complex", pch = 19, cex = 0.8, col = "orange")
  mtext(text = "B", side = 3, adj = 0.01, padj = 0.01)
  mtext("Mean Activity", side = 2, outer = TRUE, cex = 1, line = 2.2)
  mtext("Time", side = 1, outer = TRUE, cex = 1, line = 2.2)
  
#############################
#### Time by Temperature ####
#############################
  
```

```{r}
## sm ANCOVA or fANCOVA: try and see what it shows to help account for the non-linearity in our residuals
 
   x <- cbind(as.numeric(full.act.data$DateTimePOS), full.act.data$Temperature)
  ## sm ANCOVA
  ### Bowman and Azzalini Applied Smoothing Techniques for Data Analysis: 
  ## The Kernel Approach with S-Plus Illustrations
   ## This essentially compares the curves of each group and tests the null that they are the same 
   ## Does smoothing actually account for the normality assumption
  sm.ancova(x, full.act.data$mean.both, full.act.data$species, model = "parallel")

 ## fANCOVA
 ## Can apply a loess smoothing nonparametric analysis loess.ancova which uses a loess smoother
  loess.ancova(x, full.act.data$mean.both, full.act.data$species)
 
```

## Quades Method - Quade, D. (1967). Rank analysis of covariance. Journal of the American Statistical Association, 62(320), 1187-1200. 
```{r}

# Transform the CYL and MPG to Ranks
mtcars$cylRank <- rank(mtcars$cyl)
mtcars$mpgRank <- rank(mtcars$mpg)

# Convert to Ranks to Deviation Scores
mtcars$cylDev <- mtcars$cylRank - mean(mtcars$cylRank )
mtcars$mpgDev <- mtcars$mpgRank - mean(mtcars$mpgRank )

# Spearman Correlation
cor.1 <- with(mtcars, cor(mpgRank , cylRank , method="spearman"))

# Deviation Rank of MPG is Predicted from the Deviation Rank of CYL
mtcars$est.mpg <- mtcars$cylDev * cor.1

# Predicted Deviation Rank of MPG is Subtracted from the Observed Deviation Rank of CYL
mtcars$mpg.resid <- mtcars$est.mpg - mtcars$mpgDev

# ANOVA on the Residual Deviation Rank Scores
summary(aov(mpg.resid ~ am, mtcars))


# Transform Time and Temp and activity
full.act.data$actRank <- rank(full.act.data$mean.both)
full.act.data$tempRank <- rank(full.act.data$Temperature)
full.act.data$timeRank <- rank(as.numeric(full.act.data$DateTimePOS))

# Spearman Correlation

```